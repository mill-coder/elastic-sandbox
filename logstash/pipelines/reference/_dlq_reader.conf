# Description: Reads the Dead Letter Queue for a specific pipeline and indexes failed events.
# Usage: Copy this template to definitions-local/logstash/ and set pipeline_id to the
# target pipeline (e.g. "my-pipeline"). Deploy with deploy-logstash-pipelines.sh.
# Note: One DLQ reader is needed per pipeline â€” the plugin does not support wildcards.
input {
  dead_letter_queue {
    path => "/usr/share/logstash/data/dead_letter_queue"
    pipeline_id => "CHANGE_ME"
    commit_offsets => true
  }
}

output {
  elasticsearch {
    hosts => ["${LOGSTASH_ES_HOSTS}"]
    user => "${LOGSTASH_ES_USER}"
    password => "${LOGSTASH_ES_PASSWORD}"
    index => "logstash-dlq-%{+YYYY.MM.dd}"
  }
}
